<!-- Sidebar Toggle Button -->
<button id="sidebar-toggle" class="sidebar-toggle fixed top-4 left-4 p-3 bg-gray-800 text-white rounded-full z-30 hover:bg-gray-700 dark:bg-gray-600 dark:hover:bg-gray-500 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
  <span class="sr-only">Toggle sidebar</span>
  <i class="ri-menu-line"></i>
</button>

<!-- Sidebar Overlay -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-20 transition-opacity duration-300 ease-in-out opacity-0"></div>

<!-- Sidebar Structure -->
<aside id="sidebar" class="sidebar fixed top-0 left-0 h-full w-72 transform -translate-x-full bg-white dark:bg-gray-800 shadow-lg transition-all duration-300 ease-in-out z-30 overflow-hidden">
  <div class="sidebar-content h-full flex flex-col">
    
    <!-- Header -->
    <header class="p-4 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-gray-800 dark:text-white">Dashboard</h2>
        <button id="sidebar-close" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white focus:outline-none">
          <i class="ri-close-line"></i>
        </button>
      </div>
    </header>
    
    <!-- User Profile Section -->
    <div class="p-4 bg-gray-100 dark:bg-gray-750 border-b border-gray-200 dark:border-gray-600">
      <div class="flex items-center space-x-3">
        <img src="<%= user ? user.picture : 'https://cdn-icons-png.flaticon.com/512/149/149071.png' %>" alt="User Avatar" class="w-12 h-12 rounded-full border-2 border-blue-500">
        <div>
          <p class="font-semibold text-gray-800 dark:text-white"><%= user.username %></p>
          <p class="text-sm text-gray-600 dark:text-gray-300"><%= user.user_id %></p>
        </div>
      </div>
      <div class="mt-3">
        <a href="/profile" class="text-sm text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300">View Profile</a>
      </div>
    </div>
    
    <!-- Search Bar -->
    <div class="p-4 border-b border-gray-200 dark:border-gray-600">
      <div class="relative">
        <input type="text" id="sidebar-search" placeholder="Search..." class="w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <i class="ri-search-line absolute left-3 top-2.5 text-gray-400"></i>
      </div>
      <div id="search-results" class="mt-2 hidden">
        <ul class="bg-white dark:bg-gray-700 rounded-lg shadow-md"></ul>
      </div>
    </div>
    
    <!-- Sidebar Menu -->
    <nav class=" flex-1 overflow-y-auto py-4 ">
      <ul id="sidebar-menu" class="space-y-2 px-3 text-black">
        <li>
          <a href="/dashboard" class="menu-item flex items-center p-3 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200">
            <i class="ri-home-line mr-3"></i> Home
          </a>
        </li>
        <li>
          <a href="/user-tasks" class="menu-item group flex items-center p-3 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200">
            <i class="ri-task-line mr-3 text-gray-500 group-hover:text-blue-500 transition-colors duration-200"></i>
            Tasks
          </a>
        </li>
        <li>
          <button class="menu-item group flex items-center justify-between w-full p-3 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200" aria-expanded="false" aria-controls="reports-submenu">
            <div class="flex items-center">
              <i class="ri-file-chart-line mr-3 text-gray-500 group-hover:text-blue-500 transition-colors duration-200"></i>
             <a href="/dashboard/user/reports">Reports</a> 
            </div>
            <i class="ri-arrow-down-s-line transition-transform duration-200"></i>
          </button>
        
        </li>
        <li>
          <a href="/dashboard/user/meetings" class="menu-item group flex items-center p-3 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200">
            <i class="ri-team-line mr-3 text-gray-500 group-hover:text-blue-500 transition-colors duration-200"></i>
            Meetings
          </a>
        </li>
      
      </ul>
    </nav>
    
    <!-- Footer -->
    <footer class="p-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
      <div class="flex items-center justify-between">
        <a href="/logout" class="flex items-center text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 transition-colors duration-200">
          <i class="ri-logout-box-r-line mr-2"></i> Logout
        </a>
        <button id="theme-toggle" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
          <i id="theme-toggle-icon" class="ri-moon-line"></i>
        </button>
      </div>
    </footer>
  </div>
</aside>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('sidebar');
    const sidebar_menu = document.getElementById("sidebar-menu");
    const overlay = document.getElementById('sidebarOverlay');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarClose = document.getElementById('sidebar-close');
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleIcon = document.getElementById('theme-toggle-icon');
    const body = document.body;
    const searchInput = document.getElementById('sidebar-search');
    const searchResults = document.getElementById('search-results');

    function toggleSidebar() {
      sidebar.classList.toggle('-translate-x-full');
      overlay.classList.toggle('hidden');
      overlay.classList.toggle('opacity-0');
    }

    sidebarToggle.addEventListener('click', toggleSidebar);
    sidebarClose.addEventListener('click', toggleSidebar);
    overlay.addEventListener('click', toggleSidebar);

    function setTheme(isDark) {
      if (isDark) {
        body.classList.add('dark');
        themeToggleIcon.classList.remove('ri-moon-line');
        themeToggleIcon.classList.add('ri-sun-line');
        localStorage.setItem('darkMode', 'true');
      } else {
        body.classList.remove('dark');
        
        themeToggleIcon.classList.remove('ri-sun-line');
        themeToggleIcon.classList.add('ri-moon-line');
        localStorage.setItem('darkMode', 'false');
      }
      updateSidebarBackground(isDark);
    }

    function updateSidebarBackground(isDark) {
      sidebar.style.backgroundColor = isDark ? '#1F2937' : '#FFFFFF';
    }

    const savedTheme = localStorage.getItem('darkMode');
    const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (savedTheme === 'true' || (savedTheme === null && systemTheme)) {
      setTheme(true);
    } else {
      setTheme(false);
    }

    themeToggle.addEventListener('click', () => {
      const isDark = !body.classList.contains('dark');
      setTheme(isDark);
    });

    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      if (searchTerm.length > 2) {
        const results = [
          { title: 'Dashboard', url: '/dashboard' },
          { title: 'Tasks', url: '/user-tasks' },
          { title: 'Reports', url: '/dashboard/user/reports' },
          { title: 'Meetings', url: '/dashboard/user/meetings' }
        ].filter(item => item.title.toLowerCase().includes(searchTerm));

        const resultsHtml = results.map(result => `
          <li>
            <a href="${result.url}" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600">
              ${result.title}
            </a>
          </li>
        `).join('');

        searchResults.querySelector('ul').innerHTML = resultsHtml;
        searchResults.classList.remove('hidden');
      } else {
        searchResults.classList.add('hidden');
      }
    });

    document.addEventListener('click', (e) => {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.classList.add('hidden');
      }
    });

   


    setInterval(() => {
      const badge = document.getElementById('notification-badge');
      const count = parseInt(badge.textContent);
      badge.textContent = count > 0 ? count - 1 : 0;
      if (count <= 1) {
        badge.classList.add('hidden');
      }
    }, 5000);
  });
</script>